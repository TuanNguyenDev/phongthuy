$(function(){$('#addToCart').click(function(){var t=$(this);if(t.attr('data-buy')==1){var products=[],ps={id:$('#selectPsId').val(),quantity:$('#qtt').val()};products.push(ps);$.post("/cart/add",{'products':products},function(rs){if(rs.status==1){document.location.href='/cart'}});}else{$('.attr').addClass('active');$('.addCart').addClass('deactive');}});$('.attr .close').click(function(){$('.attr').removeClass('active');$('.addCart').removeClass('deactive');});$('.addCart').click(function(){var msg=$('#dMsg');var products=[],ps={};ps['id']=parseInt($(this).attr('selId'));ps['quantity']=1;products.push(ps);addToCart(products,1,function(rs){if(rs.status==1){window.location.href='/cart';}else{msg.html(rs.messages);msg.dialog({title:msgDialog,modal:true,show:'scale',buttons:[{text:"Ok",click:function(){$(this).dialog("close");}}]});}});});$('#newRelated').click(function(){var name=$(this).attr('namepro');$.post('/loadview?v=tin247',{'variable':'{"name": "'+name+'"}'},function(rs){if(rs){$('.ct-newRelated').html(rs);}});});CloudZoom.quickStart();$('#z').bind('click',function(){var cloudZoom=$(this).data('CloudZoom');$.fancybox.open(cloudZoom.getGalleryList(),{padding:0});return false;});$('#foo').carouFredSel({responsive:true,width:78,items:3,scroll:{items:1,duration:500},auto:false,prev:"#foo-next",next:"#foo-preview"});$('#tabs ul.htabs').each(function(){var $active,$content,$links=$(this).find('a');$active=$($links.filter('[href="'+location.hash+'"]')[0]||$links[0]);$active.addClass('active');$content=$($active.attr('href'));$links.not($active).each(function(){$($(this).attr('href')).hide();});$(this).on('click','a',function(e){$active.removeClass('active');$content.hide();$active=$(this);$content=$($(this).attr('href'));$active.addClass('active');$content.show();e.preventDefault();});});var vote=$('p.vote span');vote.hover(function(){$(this).addClass('voteHover');$("p.vote span:lt("+$(this).index()+")").addClass('voteHover');$("p.vote span:gt("+$(this).index()+")").removeClass('voteHover');},function(){$(this).removeClass('voteHover');$("p.vote span:lt("+$(this).index()+")").removeClass('voteHover');$("p.vote span:gt("+$(this).index()+")").removeClass('voteHover');});vote.click(function(){vote.removeClass('active voted');$(this).addClass('active voted');$("p.vote span:lt("+$(this).index()+")").addClass('active');});var showRating=$('.showRating');$('.showRating').each(function(){var t=$(this);setTimeout(function(){$.post('/rating/viewproduct'+t.attr('data-params'),{terminal:true},function(rs){if(rs){$(t.attr('data-show')).html(rs);}});},500);});$('#comment').keyup(function(){$('#digitComment').html($('#comment').val().length+' ký tự');});$('button.btnRate').click(function(e){e.preventDefault();var comment=$('#comment'),submit=true,t=$(this),msg=$('#dMsg');if(!vote.hasClass('voted')){submit=false;msg.html(msgStarRate);msg.dialog({title:msgDialog,modal:true,show:'scale',buttons:[{text:"Ok",click:function(){$(this).dialog("close");}}]});return;}
if(!comment.val()||comment.val().length<30){submit=false;msg.html(txtComment);msg.dialog({title:msgDialog,modal:true,show:'scale',buttons:[{text:"Ok",click:function(){$(this).dialog("close");}}]});return;}
if(submit){submit=false;$.post('/rating/add?type=1',{itemId:t.attr('data-pid'),point:$('.vote .voted').attr('data-rate'),storeId:t.attr('data-storeId'),title:msgRateProduct,comment:$('#comment').val()},function(rs){if(rs.code==1){submit=true;alert(rs.msg);location.reload();}else{alert(rs.msg);window.location.href=document.URL;}},'json');}});});var psId=$('#psId'),selectPsId=$('#selectPsId'),qtt=$('#qtt'),atc=$('#addToCart'),size=$('.size a'),color=$('.color a');size.click(function(){var t=$(this),attrs={};if(!t.hasClass('active')){size.removeClass('active');atc.attr('title',msgSizeandColor).attr('data-buy',2);attrs[$('.size').attr('data-column')]=t.attr('data-value');if(color.length&&!$('.color a.active').length){size.attr('title',msgColor);}else{if(t.attr('data-qtt')){t.addClass('active');selectPsId.val(t.attr('data-selId'));atc.removeAttr('title').attr('data-buy',1);}else{$.post('/product/child?psId='+psId.val(),{'attrs':attrs},function(rs){if(rs.code==1){selectPsId.val(rs.data.id);atc.removeAttr('title').attr('data-buy',1);}else{t.addClass('deactive').attr('title',msgOutofStock);}},'json');}}}});color.click(function(){var t=$(this),attrs={};if(!t.hasClass('active')){color.removeClass('active');atc.attr('title',msgSizeandColor).attr('data-buy',2);attrs[$('.color').attr('data-column')]=t.attr('data-value');if(size.length){size.removeClass('active deactive').removeAttr('title');t.addClass('active');size.each(function(){var t=$(this);attrs[$('.size').attr('data-column')]=t.attr('data-value');$.post('/product/child?psId='+psId.val(),{'attrs':attrs},function(rs){if(rs.code==1){t.attr('data-qtt',rs.data.available).attr('data-selId',rs.data.id);}else{t.addClass('deactive').attr('title',msgOutofStock).removeAttr('data-qtt');}},'json');});}else{$.post('/product/child?psId='+psId.val(),{'attrs':attrs},function(rs){if(rs.code==1){qtt.empty();for(var i=1;i<=rs.data.available;i++){qtt.append('<option value="'+i+'">'+i+'</option>');}
t.addClass('active');selectPsId.val(rs.data.id);atc.removeAttr('title').attr('data-buy',1);}else{t.addClass('deactive').attr('title',msgOutofStock);}},'json');}}});
